{{$app := env "APP_NAME"}}
{{$port := env "PORT_NUMBER"}}

global
    daemon
    maxconn {{with $maxconn:=key "service/haproxy/maxconn"}}{{$maxconn}}{{else}}4096{{end}}

defaults
    mode {{key "service/haproxy/mode"}}{{range ls "service/haproxy/timeouts"}}
    timeout {{.Key}} {{.Value}}{{end}}

listen http-in
    bind *:{{printf $port}}{{range service $app}}
    server {{.Node}} {{.Address}}:{{.Port}}{{end}}